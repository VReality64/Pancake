<html>
<head>
  <link rel="stylesheet" href="pancakeplayer.css">
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.css">
</head>

<body>

    <div class="player">
        <div class="time-controls">
            <span id="capsule"><span id="cursor"></span></span>
            <span id="playtime" class="time">0:00</span>
            <span id="endtime" class="time">0:00</span>
        </div>
        <div class="buttons">
            <i class="fa fa-stop" value="stop" onclick=""></i>
            <i class="fa fa-play" value="play" onclick=""></i>
            <i class="fa fa-pause" value="pause" onclick=""></i>
            <i class="fa fa-backward" value="backward" onclick=""></i>
            <i class="fa fa-forward" value="forward" onclick=""></i>
            <i class="fa fa-eject" value="openlist" onclick=""></i>
        </div>
    </div>

<script>

var player;
MIDI.loadPlugin(function () {
    player = MIDI.Player;
});

MIDIPlayerPercentage(player);

MIDI.loader.stop();

var MIDIPlayerPercentage = function(player) {
        
        var playtime = document.getElementById("playtime");
        var endtime = document.getElementById("endtime");
        var capsule = document.getElementById("capsule");
        var timeCursor = document.getElementById("cursor");
        
        Event.add(capsule, "drag", function (event, self) {
                Event.cancel(event);
                player.currentTime = (self.x) / 420 * player.endTime;
                if (player.currentTime < 0) player.currentTime = 0;
                if (player.currentTime > player.endTime) player.currentTime = player.endTime;
                if (self.state === "down") {
                        player.pause(true);
                } else if (self.state === "up") {
                        player.resume();
                }
        });
        //
        function timeFormatting(n) {
                var minutes = n / 60 >> 0; 
                var seconds = String(n - (minutes * 60) >> 0);
                if (seconds.length == 1) seconds = "0" + seconds;
                return minutes + ":" + seconds;
        };
        
        player.setAnimation(function(data, element) {
                var percent = data.now / data.end;
                var now = data.now >> 0;
                var end = data.end >> 0;
                if (now === end) { // go to next song

                        player.loadFile(song, player.start); // load MIDI
                }
                // display the information to the user
                timeCursor.style.width = (percent * 100) + "%";
                playtime.innerHTML = timeFormatting(now);
                endtime.innerHTML = timeFormatting(end);
        });
};

</script>
  <!-- build:js scripts/midi.js -->
  <script src="lib/midi/inc/jasmid/stream.js"></script>
  <script src="lib/midi/inc/jasmid/midifile.js"></script>
  <script src="lib/midi/inc/jasmid/replayer.js"></script>
  <script src="lib/midi/inc/Base64.js"></script>
  <script src="lib/midi/inc/base64binary.js"></script>
  <script src="lib/midi/inc/WebMIDIAPI.js"></script>
  <!--<script src="midi/inc/SoundManager2/script/soundmanager2.js"></script>-->
  <script src="lib/midi/js/MIDI/AudioDetect.js"></script>
  <script src="lib/midi/js/MIDI/LoadPlugin.js"></script>
  <script src="lib/midi/js/MIDI/Player.js"></script>
  <script src="lib/midi/js/MIDI/Plugin.js"></script>
  <script src="lib/midi/js/Window/DOMLoader.script.js"></script>
  <script src="lib/midi/js/Window/DOMLoader.XMLHttp.js"></script>
  <script src="lib/midi/js/Window/Event.js"></script>
  <script src="lib/midi/pancakeplayer.js"></script>
  <!-- endbuild -->
</body>
</html>